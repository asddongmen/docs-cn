## 双向复制

从 v6.5.0 版本开始，TiCDC 支持在多个 TiDB 集群之间进行双向复制。基于该功能，你可以使用 TiCDC 来构建 TiDB 集群的多写多活解决方案。

### 使用双向复制

本小节以在 2 个 TiDB 集群之间进行双向复制为例，介绍双向复制的使用方法。

#### 部署双向复制

1. 使用数据导入工具将两个集群的数据同步为一致的状态。

2. 在这两个 TiDB 集群之间部署两套 TiCDC 集群，图中箭头所指的方向即为该 TiCDC 集群同步数据的流向。集群的拓扑如下图所示。

![TiCDC bidirectional replication](/media/ticdc/ticdc-bidirectional-replication.png)


3. 在创建每一个同步任务时，在 `--config` 参数所指定的配置文件中添加如下配置:

    ```toml
    # 是否启用 bdr 模式
    bdr-mode = true
    ```

这样，以上搭建好的集群即可对数据进行双向复制。

#### 停止双向同步

1. 等待所有数据同步完成之后停止 changefeed 任务即可。

### 使用限制

- 双向复制的集群不支持同步 DDL，需要停止对应的表的写入操作，等待数据同步完成之后手动在每一个 TiDB 集群单独执行所有的 DDL。等待 DDL 完成之后重新恢复写入。

- 双向复制的集群不具备写冲突的检测功能，写冲突将会导致未定义问题。你需要在业务层面保证不出现写冲突。

- 双向同步可以支持多个集群，但是每个集群都要与其他集群互相连接。
